---
title: "Introduction to Shiny Apps"
# subtitle: "âš”<br/>with xaringan"
author: "Kasia Kedzierska"
institute: "DPhil Candidate in Genomic Medicine and Statistics<br/>WHG, University of Oxford"
date: "2022/04/22 (updated: `r Sys.Date()`)"
output:
  xaringan::moon_reader:
    # css: ["xaringan-themer.css", "custom.css"]
    css: ["xaringan-themer.css", "width.css", "misc.css"]
    # yolo: true
    lib_dir: libs
    nature:
      highlightStyle: github
      highlightLines: true
      highlightSpans: true
      countIncrementalSlides: false
---

```{r xaringan-themer, include=FALSE, warning=FALSE}
library(xaringanthemer)
style_mono_light(base_color = "#23395b")
```

```{r xaringanExtra, include=FALSE, echo=FALSE}
xaringanExtra::use_fit_screen()
xaringanExtra::use_clipboard()

xaringanExtra::use_progress_bar(color = "#23395b", 
                                location = "top", height = "10px")
xaringanExtra::use_extra_styles(hover_code_line = TRUE, 
                                mute_unhighlighted_code = TRUE)
```

```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)
```

# About me

Hello! 

I'm a 4th year (ouch!) PhD student in Genomic Medicine at the Wellcome Centre for Human Genetics.

I use R a lot - for data viz, data analysis, to create this slideshow, for my personal website and to play with Generative aRt. It is safe to say I like R a bit.

I also like questions, so please go ahead and ask me any throughout this workshop. If at any point you feel lost let me know. I also brought help with me - so there's twice as many of us to help you out. :)


---

# Before we start

* **This workshop is very much hands on**. Please make sure you cloned the repository and it is up to date. We will go through a presentation and run/edit examples and create our own applications all throughout. 

--

* **This is an Introduction to Shiny**. The goal of this workshop is to give you and idea of what `shiny` is, and help you break the ice and create your first Hello world! applications and dashboards.

--

* **Check out the other materials**. I list a lot of other resources - R community is brilliant in providing support in learning new skills and there is plenty of 

---

# Asking for help

For this workshop we will use green, orange and red sticky notes. The way this works is at various points, when you will get to do your exercises I will ask you to put one of the stickers on your laptop.

#### <span style="background-color: #84A59D">green</span> 
I'm doing well! Keeping up, I am working on the example, know what to do.  

#### <span style="background-color: #F6BD60">orange</span>
I am a little bit lost, not sure exactly do, `R` speaks warnings to me.  

#### <span style="background-color: #B20D30">red</span>

I need help, I am lost, not sure what am I supposed to do or `R` is throwing errors at me.

---

# Outline

* Shiny - introduction
  * What is shiny?
  * Gallery of shiny examples
  * Resources
* Anatomy of shiny apps
  * server, ui
  * inputs, outputs
  * layout
  * reactivity
* Dashboards and more
* Hands-on
  * first steps
  * structured example
  * dashboard example
  * app from scratch

---
class: inverse, center, middle

# Shiny - introduction  

---

## What is Shiny?

> Shiny is an R package that makes it easy to build interactive web apps straight from R.

In other words it allows us to build websites with results of our analyses without having to learn html or javascript*. 

.footnote[**not entirely true as the more you work with shiny the more you will want to tweak it and use some html and/or javascript. But you don't need at the start for sure!*]


---

### Palmer penguins example - plot

```{r penguin_plot, echo=FALSE, warning=FALSE, message=FALSE, fig.width=9, dev.args=list(bg = "transparent"), fig.height=5, dpi=300}
library(tidyverse)
library(patchwork)
library(glue)
library(palmerpenguins)

xaxis <- "bill_length_mm"
x_name <- "Bill length [mm]"
yaxis <- "bill_depth_mm"
y_name <- "Bill depth [mm]"
colorby <- "species"

plt_all <-
  penguins %>%
  ggplot(aes_string(x = xaxis, y = yaxis)) +
  geom_point() +
  labs(x = x_name,
       y = y_name) 

plt <-
  penguins %>%
  ggplot(aes_string(x = xaxis, y = yaxis, color = colorby)) +
  geom_point() +
  labs(x = x_name,
       y = y_name,
       color = "Species") +
  ggthemes::scale_color_economist() 

patch <- 
  plt_all + 
  plt +
  plot_annotation(title = "Palmer Penguins size",
                  subtitle = glue(
                    "{x_name} and {y_name} for {glue_collapse(sort(unique(penguins$species)), sep = ', ', last = ' and ')} Penguins.")) 

patch & theme_minimal() & theme(legend.position = "bottom", 
                                panel.grid.major = element_line(color = "white"))
```


---

### Palmer penguins example - app

<iframe id="scaled-frame" src="https://kzkedzierska.shinyapps.io/penguin_plot_/" width=900 height=480 frameBorder="0"></iframe>

---
## Shiny Apps gallery

<iframe src="https://shiny.rstudio.com/gallery/#demos" width=900 height=425 frameBorder="0"></iframe>

.footnote[[shiny.rstudio.com/gallery/](https://shiny.rstudio.com/gallery/)]

---
## Resources

* [Mastering Shiny](https://mastering-shiny.org/) by Hadley Wickham
* [Shiny tutorial](https://shiny.rstudio.com/tutorial/) on RStudio website

.pull-left.w20[
```{r, echo=FALSE}
knitr::include_graphics("misc/mastering_shiny_cover.png")
```
]

.pull-right.w75[
```{r, echo=FALSE}
knitr::include_app("https://shiny.rstudio.com/tutorial/written-tutorial/lesson1/",
                   height = 250)
```
]


---
class: inverse, center, middle

# Anatomy of shiny  

---

## Anatomy of Shiny App 

Shiny requires:

* user interface, the HTML webpage humans interact with
* server, the powerhouse of an app

.pull-left.w55[

```{r, eval=FALSE}
library(shiny) #<<

ui <- fluidPage(
  "Hello, world!"
)

server <- 
  function(input, output, session) {
}
shinyApp(ui, server) 
```
]

.pull-right.w40[
.center[
<img src="misc/hello_world.png" />
]
]

---
## Anatomy of Shiny App  

Shiny requires:

* **user interface**, the HTML webpage humans interact with
* server, the powerhouse of an app

.pull-left.w55[

```{r, eval=FALSE}
library(shiny) 

ui <- fluidPage( #<<
  "Hello, world!" #<<
) #<<

server <- 
  function(input, output, session) {
}
shinyApp(ui, server) 
```
]

.pull-right.w40[
.center[
<img src="misc/hello_world.png" />
]
]

---
## Anatomy of Shiny App 

Shiny requires:

* user interface, the HTML webpage humans interact with
* **server**, the powerhouse of an app

.pull-left.w55[

```{r, eval=FALSE}
library(shiny) 

ui <- fluidPage(
  "Hello, world!"
)

server <-  #<<
  function(input, output, session) { #<<
  } #<<
shinyApp(ui, server) 
```
]

.pull-right.w40[
.center[
<img src="misc/hello_world.png" />
]
]

---
## Anatomy of Shiny App 

Shiny requires:

* user interface, the HTML webpage humans interact with
* server, the powerhouse of an app

.pull-left.w55[

```{r, eval=FALSE}
library(shiny)

ui <- fluidPage(
  "Hello, world!"
)

server <- 
  function(input, output, session) {
}
shinyApp(ui, server) #<<
```
]

.pull-right.w40[
.center[
<img src="misc/hello_world.png" />
]
]

---
## Histogram App

.pull-left.w60[
```{r eval=FALSE}
library(shiny)

ui <- fluidPage(
  title = "Histogram App",
  sliderInput("n", 
              "Number of observations", 
              value = 500,
              min = 1, max = 10000),
  plotOutput("hist")
)

server <- 
  function(input, output, session) {
    output$hist <- renderPlot({
      nobs <- input$n
      hist(rnorm(nobs))
    })
  }
shinyApp(ui, server)
```
]

.pull-right.w35[
```{r echo=FALSE}
knitr::include_graphics("misc/histogram_app.png")
```
]

---
## Inputs

.pull-left.w48[
```{r echo=FALSE}
knitr::include_graphics("misc/inputs_left.png")
```
]

.pull-right.w48[
```{r echo=FALSE}
knitr::include_graphics("misc/inputs_right.png")
```
]

---
## Inputs


```{r eval=FALSE}
library(shiny)

ui <- fluidPage(
  title = "Histogram App",
  sliderInput("n", #<<
              "Number of observations", #<<
              value = 500, #<<
              min = 1, max = 10000), #<<
  plotOutput("hist")
)

server <- 
  function(input, output, session) {
    output$hist <- renderPlot({
      nobs <- input$n #<<
      hist(rnorm(nobs))
    })
  }
shinyApp(ui, server)
```

---
## Outputs

<img src="misc/outputs.png" />

---
## Outputs

```{r eval=FALSE}
library(shiny)

ui <- fluidPage(
  title = "Histogram App",
  sliderInput("n", 
              "Number of observations", 
              value = 500,
              min = 1, max = 10000), 
  plotOutput("hist") #<<
)

server <- 
  function(input, output, session) {
    output$hist <- renderPlot({ #<<
      nobs <- input$n 
      hist(rnorm(nobs)) #<<
    }) #<<
  }
shinyApp(ui, server)
```

---
## Layout

---
## Reactive elements 

The key functionality of Shiny are reactive elements we can add to our apps. For example, remember the plot from previous simple example? We were able to add regression line after selecting the proper option. That is because the app **reacted** to our (= user) input.

.center[
<img src="misc/server_ui.svg" />
]

---
## Reactive elements 

.pull-left.w60[
.center[
Inside the server block we will have a code like that:  
]
  
```{r, eval=FALSE}
server <- function(input, output) {
  ...
  output$plt <- 
    renderPlot({
      penguins %>%
        ggplot(aes(x = bill_length_mm, 
                   y = bill_depth_mm)) +
        geom_point() + 
        { if(input$smooth == "yes") { 
          geom_smooth(se = FALSE, 
                      method = "lm", 
                      formula = "y ~ x")
          }}
    })
  ...
}
```

] 

.pull-right.w35[
.center[
And in the UI this is what user will see depending chosen option: 

```{r reatcive_gif, echo=FALSE, message=FALSE, error=FALSE, warning=FALSE}
save_to_dir <- "misc/gif_smooth/"

if (length(list.files(save_to_dir, pattern = ".png")) < 2) {
  plt_penguin_gif1 <-
    penguins %>%
    ggplot(aes(x = bill_length_mm, y = bill_depth_mm)) +
    geom_point() +
    labs(x = "Bill length [mm]",
         y = "Bill depth [mm]",
         title = "Smooth: no") +
    ggthemes::theme_economist()
  
  ggsave(plot = plt_penguin_gif1, 
         filename = "plt_penguin_gif1.png", path = save_to_dir, 
         width = 4, height = 4, dpi = 96,
         bg = "transparent")
  
  plt_penguin_gif2 <-
    plt_penguin_gif1 +
    geom_smooth(se = FALSE, method = "lm", formula = "y ~ x") +
    labs(title = "Smooth: yes")
  
  ggsave(plot = plt_penguin_gif2, 
         filename = "plt_penguin_gif2.png", path = save_to_dir,  
         width = 4, height = 4, dpi = 96,
         bg = "transparent")
}

library(magick)
imgs <- list.files(save_to_dir, full.names = TRUE)
img_list <- lapply(imgs, image_read)

## join the images together
img_joined <- image_join(img_list)

## animate at 2 frames per second
img_animated <- image_animate(img_joined, fps = 1)

## view animated image
img_animated
```

]]

---
class: inverse, center, middle

# Dashboards  

---
# Dashboards

.pull-left.w48[

[flexdashboard](https://pkgs.rstudio.com/flexdashboard/index.html) 

* R Markdown
* **Super easy**
* Static or dynamic
]

.pull-right.w48[
[shinydashboard](https://rstudio.github.io/shinydashboard/index.html)

* Shiny UI code
* Not quite as easy
* Dynamic
]

--

.pull-left.w48[
```{markdown}
---
title: "Untitled"
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: fill
---
```

]

.pull-right.w48[
```{r, eval=FALSE}
library(shiny)
library(shinydashboard)

ui <- dashboardPage(
  dashboardHeader(),
  dashboardSidebar(),
  dashboardBody()
)
server <- function(input, 
                   output) {
}
shinyApp(ui, server)
```
]


---
# Dashboards

.pull-left.w48[

[flexdashboard](https://pkgs.rstudio.com/flexdashboard/index.html) 

* R Markdown
* **Super easy**
* Static or dynamic
]

.pull-right.w48[
[shinydashboard](https://rstudio.github.io/shinydashboard/index.html)

* Shiny UI code
* Not quite as easy
* Dynamic
]

.pull-left.w48[
```{r, echo=FALSE}
knitr::include_graphics("misc/flexdashboard.png")
```

]

.pull-right.w48[
```{r, echo=FALSE}
knitr::include_graphics("misc/shinydashboard.png")
```
]


---

## [Flexdashboard](https://pkgs.rstudio.com/flexdashboard/index.html)

```{r, echo=FALSE}
knitr::include_app("https://pkgs.rstudio.com/flexdashboard/index.html")
```


.footnote[
You can find more examples [here](https://pkgs.rstudio.com/flexdashboard/articles/examples.html).
]

---
class: inverse, center, middle

# Exercises  

---
# Hands on exercises

In this repo there are 4 exercises:

* 01_simple
* 02_structured
* 03_dashboard
* 04_app_from_scratch

Each exercise is placed in sepearate directory with instructions in README files and 
---
class: inverse, center, middle

# The end  

---

# Thanks for following!

It's now time for questions and chat :)

.center[**Upcoming [NGSchool](https://ngschool.eu/) Society Events**]

<table>
<tr>
<td><img src="misc/ngsymposium-logo-2022.svg" /> </td>
<td><img src="misc/ngschool-logo-2022.svg" /></td>
</tr>
<tr>
<td>23 - 24.09.2022 </td>
<td>15 - 23.09.2022</td>
</tr>
<tr>
<td>Warsaw, Poland</td>
<td>Jablonna near Warsaw, Poland</td>
</tr>
<tr>
<td>Abstracts deadline: <b>23.05</b> <br>
Registration deadline: 20.08 <br>
Early Bird: <b>11.07</b> </td>
<td>Registration deadline: <b>30.05</b> <br> Fee: 200 EUR (includes accom. and board!)</td>
</tr>
<tr>
<td><a href=https://ngschool.eu/ngsymposium2022/>ngschool.eu/ngsymposium2022/</a></td>
<td><a href=https://ngschool.eu/ngschool2022/>ngschool.eu/ngschool2022/</a></td>
<tr>
</table>

.footnote[Slides created via the R packages [**xaringan**](https://github.com/yihui/xaringan) and [**xaringanExtra**](https://pkg.garrickadenbuie.com/xaringanExtra/#/).]