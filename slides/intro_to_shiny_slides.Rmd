---
title: "Introduction to Shiny Apps"
# subtitle: "âš”<br/>with xaringan"
author: "Kasia Kedzierska"
institute: "DPhil Candidate in Genomic Medicine and Statistics<br/>WHG, University of Oxford"
date: "2022/04/22 (updated: `r Sys.Date()`)"
output:
  xaringan::moon_reader:
    # css: ["xaringan-themer.css", "custom.css"]
    css: xaringan-themer.css
    # yolo: true
    lib_dir: libs
    nature:
      highlightStyle: github
      highlightLines: true
      highlightSpans: true
      countIncrementalSlides: false
---

```{r xaringan-themer, include=FALSE, warning=FALSE}
library(xaringanthemer)
style_mono_light(base_color = "#23395b")
```

```{r xaringanExtra, include=FALSE, echo=FALSE}
xaringanExtra::use_fit_screen()
xaringanExtra::use_clipboard()

xaringanExtra::use_progress_bar(color = "#23395b", 
                                location = "top", height = "10px")
xaringanExtra::use_extra_styles(hover_code_line = TRUE, 
                                mute_unhighlighted_code = FALSE)
```

```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)
```


class: inverse, center, middle

# Why Shiny?

---

# Why Shiny?

> Shiny is an R package that makes it easy to build interactive web apps straight from R.

---

# Simple example

For interactivity.

.pull-left.w40[

```{r, echo=FALSE, warning=FALSE, message=FALSE, fig.width=8, fig.height=5, dpi=96}
library(tidyverse)
library(patchwork)
library(glue)
library(palmerpenguins)

xaxis <- "bill_length_mm"
x_name <- "Bill length [mm]"
yaxis <- "bill_depth_mm"
y_name <- "Bill depth [mm]"
colorby <- "species"

plt_all <-
  penguins %>%
  ggplot(aes_string(x = xaxis, y = yaxis)) +
  geom_point() +
  labs(x = x_name,
       y = y_name) +
  theme_classic() 

plt <-
  penguins %>%
  ggplot(aes_string(x = xaxis, y = yaxis, color = colorby)) +
  geom_point() +
  labs(x = x_name,
       y = y_name,
       color = "Species") +
  theme_classic() +
  theme(legend.position = "bottom") +
  scale_color_viridis_d() 

plt_all + plt +
  plot_annotation(title = "Palmer Penguins size",
                  subtitle = glue("{x_name} and {y_name} for {glue_collapse(sort(unique(penguins$species)), sep = ', ', last = ' and ')} Penguins."))
```

]

.pull-right.w60[

<iframe src="https://kzkedzierska.shinyapps.io/penguin_plot_/" width=1200 height=600></iframe>

]

---
class: inverse, center, middle

# Structure
---


---
.center[
<img src="misc/server_ui.svg" />
]

.pull-left[
.center[
Inside the server block we will have a code like that:  
]
  

```{r, eval=FALSE}
server <- function(input, output) {
  ...
  output$plt <- 
    renderPlot({
      penguins %>%
        ggplot(aes(x = bill_length_mm, y = bill_depth_mm)) +
        geom_point() + 
        { if(`input$smooth == "yes"`) {
          geom_smooth(se = FALSE, 
                      method = "lm", 
                      formula = "y ~ x")
        }}
    })
  ...
}
```

] 

.pull-right[
.center[
And in the UI this is what user will see depending chosen option: 

```{r, echo=FALSE, message=FALSE, error=FALSE, warning=FALSE}
save_to_dir <- "misc/gif_smooth/"

library(ggthemes)
if (length(list.files(save_to_dir, pattern = ".png")) < 2) {
  plt_penguin_gif1 <-
    penguins %>%
    ggplot(aes(x = bill_length_mm, y = bill_depth_mm)) +
    geom_point() +
    labs(x = "Bill length [mm]",
         y = "Bill depth [mm]",
         title = "Smooth: no") +
    theme_economist()
  
  ggsave(plot = plt_penguin_gif1, 
         filename = "plt_penguin_gif1.png", path = save_to_dir, 
         width = 4, height = 4, dpi = 96,
         bg = "transparent")
  
  plt_penguin_gif2 <-
    plt_penguin_gif1 +
    geom_smooth(se = FALSE, method = "lm", formula = "y ~ x") +
    labs(title = "Smooth: yes")
  
  ggsave(plot = plt_penguin_gif2, 
         filename = "plt_penguin_gif2.png", path = save_to_dir,  
         width = 4, height = 4, dpi = 96,
         bg = "transparent")
}

library(magick)
imgs <- list.files(save_to_dir, full.names = TRUE)
img_list <- lapply(imgs, image_read)

## join the images together
img_joined <- image_join(img_list)

## animate at 2 frames per second
img_animated <- image_animate(img_joined, fps = 1)

## view animated image
img_animated
```

]]




---

class: center, middle

# Thanks!

Slides created via the R package [**xaringan**](https://github.com/yihui/xaringan).